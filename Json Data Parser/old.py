import json
import csv
import re
from math import comb

data = {"dataType": 1, "readXor": 0, "readTimestamp": "2021-03-11T04:42:52+00:00",
        "readData": "\u0002P.01(0210310001500)(00)(15)(6)(1.9)(kWh)(2.9)(kWh)(5.9)(kvarh)(6.9)(kvarh)(7.9)(kvarh)(8.9)(kvarh)\r\n(100.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(200.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(300.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.024)(000.000)(000.000)(000.001)(000.000)\r\n(000.000)(000.079)(000.000)(000.000)(000.007)(000.000)\r\n(000.000)(000.078)(000.000)(000.000)(000.006)(000.000)\r\n(000.000)(000.079)(000.000)(000.000)(000.007)(000.000)\r\n(000.000)(000.079)(000.000)(000.000)(000.006)(000.000)\r\n(000.000)(000.078)(000.000)(000.000)(000.006)(000.000)\r\n(000.000)(000.079)(000.000)(000.000)(000.007)(000.000)\r\n(000.000)(000.079)(000.000)(000.000)(000.006)(000.000)\r\n(000.000)(000.078)(000.000)(000.000)(000.007)(000.000)\r\n(000.000)(000.005)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.001)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r\n(000.000)(000.000)(000.000)(000.000)(000.000)(000.000)\r",
        "readLen": 5476, "meterFlag": "ABB6@V4.50 ", "readCount": 0, "meterSerial": "00704945"}
# Creates a list containing 5 lists, each of 8 items, all set to 0


EXCEL_ROW, EXCEL_COLS = (49, 33)
combined_matrix = [[0 for i in range(EXCEL_COLS)] for j in range(EXCEL_ROW)]


#########################################################################################################
class Parser:
    count = 0
    File_name = ""
    Matrix_8x8 = [[0 for i in range(1)] for j in range(192)]

    def __init__(self, json_list):
        self.json_list = json_list
        print(len(json_list))
        self.set_file_name()
        self.json_list_parser(type)

    #########################################################################################################
    def clocks_set(self):
        clocks_name = [0] * 48
        clocks = ["00:00 - 01:00", "01:00 - 02:00", "02:00 - 03:00", "03:00 - 04:00",
                  "04:00 - 05:00", "05:00 - 06:00", "06:00 - 07:00", "07:00 - 08:00",
                  "08:00 - 09:00", "09:00 - 10:00", "10:00 - 11:00", "11:00 - 12:00",
                  "12:00 - 13:00", "13:00 - 14:00", "14:00 - 15:00", "15:00 - 16:00",
                  "16:00 - 17:00", "17:00 - 18:00", "18:00 - 19:00", "19:00 - 20:00",
                  "20:00 - 21:00", "21:00 - 22:00", "22:00 - 23:00", "23:00 - 24:00"]
        index = 0
        for i in range(0, 48, 2):
            clocks_name[i] = clocks[index]
            clocks_name[i + 1] = clocks[index]
            index = index + 1
        return clocks_name

    #########################################################################################################
    def day_set(self):
        days_and_state = ["Clocks ", "State", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14",
                          "15", "16",
                          "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"]

        return days_and_state

    #########################################################################################################
    def state_set(self):
        state = ["Alis", "Veris"]
        return state

    #########################################################################################################
    def set_file_name(self):
        year = ""
        month = ""
        day = ""
        count = 0
        for text in self.json_list:
            if str(text).__contains__("P.01") == True and count == 0:
                year = text[7:9]
                month = text[9:11]
                day = text[11:13]
                count += 1
        print("year: ", year, "month:", month, "day: ", day)
        self.File_name = year + month + day

    #########################################################################################################
    def json_list_parser(self, tpye):
        print("result")

        clocks = self.clocks_set()
        state = self.state_set()
        days = self.day_set()

        for colummn in range(EXCEL_ROW - 1):
            combined_matrix[colummn + 1][1] = state[colummn % 2]

        for colummn in range(EXCEL_ROW - 1):
            combined_matrix[colummn + 1][0] = clocks[colummn]

        for i in range(EXCEL_COLS):
            combined_matrix[0][i] = days[i]

        for row in range(EXCEL_ROW):
            for j in range(EXCEL_COLS):
                print(combined_matrix[row][j], end=' ')
            print()

    #########################################################################################################
    def write_cvs(self):
        # Open File
        resultFyle = open("output.csv", 'w')
        i = 0
        # Write data to file
        for r in self.json_list:
            metin = self.parse_brackets(r)
            if metin != "":
                resultFyle.write(metin[0] + "\n")
                resultFyle.write(metin[1] + "\n")

                first_data_block = metin[0]
                second_data_block = metin[1]

                first_data_block = first_data_block.replace('(','')
                first_data_block = first_data_block.replace(')', '')

                second_data_block = second_data_block.replace('(', '')
                second_data_block = second_data_block.replace(')', '')

                self.Matrix_8x8 [i][0] = first_data_block
                self.Matrix_8x8[i+1][0] = second_data_block
                i +=2
        resultFyle.close()

        with open(self.File_name + '.csv', 'w') as f:
            csvWriter = csv.writer(f, delimiter=',')
            csvWriter.writerows(combined_matrix)
        f.close()

    #########################################################################################################
    def parse_brackets(self, s):
        s = str(s)
        res = ""
        if (s.__contains__("P.01") != True):
            print("s: ", s)
            res = re.findall(r'\(.*?\)', s)

            # printing result
            print("i.", self.count, "The element between brackets : " + str(res), "1. eleman: ", res[0], "2. eleman: ",
                  res[1])
            self.count = self.count + 1

        return res


#########################################################################################################
def parse_txt(s):
    txt = s.split("\r\n")
    return txt


if __name__ == '__main__':
    s = parse_txt(data.get("readData"))
    parse = Parser(s)
    parse.write_cvs()

